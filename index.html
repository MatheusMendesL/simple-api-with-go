<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>teste das rotas da api</title>
</head>

<body>
    <div class="Users" style="display: none;">
        <h1>Choose one user to edit!</h1>
        <ul id="list">

        </ul>

        <form id="EditForm">
            <input type="text" placeholder="First Name" name="FirstName">
            <input type="text" placeholder="Last Name" name="LastName">
            <input type="text" placeholder="Biography" name="Biography">
            <button type="submit" id="edit">Edit</button>
        </form>


        <h1>Click in one of the names and here to delete</h1>

        <button id="Delete">Delete</button>
    </div>
    <h1>To add an User</h1>
    <form id="UserForm">
        <input type="text" placeholder="First Name" name="FirstName">
        <input type="text" placeholder="Last Name" name="LastName">
        <input type="text" placeholder="Biography" name="Biography">
        <button type="submit" id="send">Send</button>
    </form>


    <h1>To search one user, write his name</h1>
    <form id="SearchForm">
        <input type="text" placeholder="Name" name="FirstName">
        <button type="submit" id="send">Search</button>
    </form>
</body>

<script>


    document.addEventListener("DOMContentLoaded", async () => {

        const res = await fetch("http://localhost:8080/api/user/", {
            method: "GET"
        })

        const data = await res.json()
        const list = document.querySelector("#list")
        console.log(data.data)
        if (Object.keys(data.data).length !== 0 ) {
            document.querySelector(".Users").style.display = "block"
        }

        Object.values(data.data).forEach(u => {
            li = document.createElement("li")
            li.id = u.Id
            li.innerText = u.FirstName
            list.appendChild(li)
            li.addEventListener("click", () => {

                document.querySelector("#Delete").addEventListener("click", async (e) => {
                    const res = await fetch("http://localhost:8080/api/user/" + u.Id, {
                        method: "DELETE"
                    });

                    const result = await res.json();
                    console.log(result);
                    location.reload()
                })

                document.querySelector("#EditForm").addEventListener("submit", async (e) => {
                    const data = {
                        FirstName: e.target.FirstName.value,
                        LastName: e.target.LastName.value,
                        Biography: e.target.Biography.value
                    };


                    const res = await fetch("http://localhost:8080/api/user/" + u.Id, {
                        method: "PUT",
                        body: JSON.stringify(data)
                    });

                    const result = await res.json();
                    console.log(result);

                })
            })
        });

    });

    document.querySelector("#UserForm").addEventListener("submit", async (e) => {

        const data = {
            FirstName: e.target.FirstName.value,
            LastName: e.target.LastName.value,
            Biography: e.target.Biography.value
        };


        const res = await fetch("http://localhost:8080/api/user/", {
            method: "POST",
            body: JSON.stringify(data)
        });

        const result = await res.json();
        console.log(result);

    })



</script>

</html>